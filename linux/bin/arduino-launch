#!/bin/sh -x

# resolving this script path
BIN_ABSPATH=$(cd "$(dirname "$0")"; pwd)

# resolving messages folder path
MESSAGES_ABSPATH=$BIN_ABSPATH/../messages

# Retrieve handle and command
HANDLE=$1
COMMAND=$2

# removing handle and command from the list of params
shift 2

# files to hold stdout and stderr output generated by running command
TMP_OUT=`mktemp`
TMP_ERR=`mktemp`

# executing command
COMPLETE_COMMAND="$COMMAND $*"
($COMPLETE_COMMAND) 1>$TMP_OUT 2>$TMP_ERR
EXIT_CODE=$?

# creating messages files
MESSAGE_FILE=`date +%s`
MESSAGE_FILE="$MESSAGE_FILE-$COMMAND-$HANDLE"

mv $TMP_OUT $MESSAGES_ABSPATH/$MESSAGE_FILE.out
mv $TMP_ERR $MESSAGES_ABSPATH/$MESSAGE_FILE.err
